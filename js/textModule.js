function myAddText(){GlobalResource[GlobalResource.length]={};currentResource=GlobalResource[GlobalResource.length-1];drawBox=paper.rect(0,0,viewBox[2],viewBox[3]);drawBox.attr({fill:"green",opacity:"0.5"});drawBox.click(createPath);currentTextIndex++}function dragStarts(){currentResource.difference=null;currentResource.textNode.attr({opacity:"1.0"})}function dragStops(){if(!currentResource.realTextNode)currentResource.realTextNode=[];currentResource.difference=[[]];var e=$(currentResource.path.node).attr("d");var t=null;for(var n=0,r=currentResource.textNode.length;n<r;n++){t=currentResource.textNode[n].getBBox();if(Raphael.isPointInsidePath(e,t.x,t.y)&&Raphael.isPointInsidePath(e,t.x2,t.y2)){currentResource.textNode[n].attr({opacity:"1.0"})}else{currentResource.textNode[n].attr({opacity:"0.5"})}}currentResource.matrix=currentResource.textNode[0].transform()}function textMouseOut(){}function textMouseOver(){for(var e=0,t=GlobalResource.length;e<t;e++){if(GlobalResource[e].rect==this)currentResource=GlobalResource[e]}}function manuallyHide(){var e=currentResource.freeTransform.handles;var t=e.bbox;for(var n=0,r=t.length;n<r;n++){t[n].element.attr("opacity","0")}e.x.disc.attr("opacity","0");e.x.line.attr("opacity","0");e.y.disc.attr("opacity","0");e.y.line.attr("opacity","0")}function manuallyShow(){var e=currentResource.freeTransform.handles;var t=e.bbox;for(var n=0,r=t.length;n<r;n++){t[n].element.attr("opacity","1")}e.x.disc.attr("opacity","1");e.x.line.attr("opacity","1");e.y.disc.attr("opacity","1");e.y.line.attr("opacity","1")}var currentTextIndex=0;var raphaelText=[];var initialPos=[],globalcount=0,raphaelText=[],freetransform=[],globalX=[],globalY=[],t,curElmIndex,textPath,currentTextIndex=0,indexKeeper=0,bleedingBox=[],boundingcircle=[],paper,curverPaper,ptStr=[],rootrect,curve,straightPath,textElementProp=[];var GlobalResource=[];var currentResource=null;var drawBox=null;$("document").ready(function(){$("#addText").click(myAddText)});Raphael.fn.myCreateTextNode=function(e,t){var n;n=this.customAttributes.textArray;e=e||{};var r={fontSize:e.fontSize||18,data:e.data||$("#freeText").val()||"Enter Text",fontFamily:e.fontFamily||$("#font_family").val()||"MyriadProRegular",textNode:n[n.length],letterSpacing:e.letterSpacing||5,path:e.path||bleedingBox[currentTextIndex],textPath:e.textPath||straightPath.toString(),lineSpacing:e.lineSpacing||10,x:e.x||0,y:e.y||0};var i=null;if(currentResource.textNode){i=currentResource.textNode}else{i=this.set();currentResource.textNode=i}var s=r.data.split(/\r\n|\r|\n/g);var o=0,u=100;var a=[[]];for(var f=0,l=s.length;f<l;f++){a[f]=[];for(var c=0,h=s[f].length;c<h;c++){var p=s[f].charAt(c);if(p==" "){o+=r.letterSpacing+5;continue}a[f][c]=paper.print(o,u,p,paper.getFont(r.fontFamily),30);o+=a[f][c].getBBox().width+r.letterSpacing;i.push(a[f][c])}o=0;if(a[f][0])u+=a[f][0].getBBox().height+r.letterSpacing}var d=i.getBBox();currentResource.rect=this.rect(d.x,d.y,d.width,d.height).attr({fill:"blue",opacity:"0.0"});if(currentResource.matrix){for(var f=0,l=i.length;f<l;f++){i[f].transform(currentResource.matrix)}currentResource.rect.transform(currentResource.matrix)}this.customAttributes.textArray.push(i);currentResource.rect.mouseover(textMouseOver);currentResource.rect.mouseout(textMouseOut);currentResource.freeTransform=paper.freeTransform(currentResource.rect,{attrs:{fill:"#1898B6",boundary:false},draw:["bbox"],scale:["bboxCorners"],distance:"2.0",drag:"self"},function(e,t){var n=currentResource.rect.transform();for(var r=0,s=currentResource.textNode.length;r<s;r++){i[r].transform(n)}if(t[0]=="drag end"||t[0]=="scale end"||t[0]=="rotate end"){dragStops()}if(t[0]=="drag start"||t[0]=="scale start"||t[0]=="rotate start"){dragStarts()}})}

